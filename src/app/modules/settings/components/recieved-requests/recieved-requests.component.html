<div class="requests-container">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <!-- Header Section -->
  <div class="requests-header">
    <div class="header-content">
      <div class="header-title">
        <h1>
          <i class="pi pi-inbox"></i>
          Gelen İstekler
        </h1>
        <p class="header-subtitle">
          Kullanıcı isteklerini yönetin ve yanıtlayın
        </p>
      </div>
      <div class="header-stats">
        <div class="stat-item">
          <span class="stat-number">{{ filteredRequests.length }}</span>
          <span class="stat-label">Toplam İstek</span>
        </div>
        <div class="stat-item pending">
          <span class="stat-number">{{ draftCount }}</span>
          <span class="stat-label">Taslak</span>
        </div>
        <div class="stat-item approved">
          <span class="stat-number">{{ approvedCount }}</span>
          <span class="stat-label">Onaylanan</span>
        </div>
        <div class="stat-item rejected">
          <span class="stat-number">{{ rejectedCount }}</span>
          <span class="stat-label">Reddedilen</span>
        </div>
        <div class="stat-item canceled">
          <span class="stat-number">{{ canceledCount }}</span>
          <span class="stat-label">İptal Edilen</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-container">
      <div class="filter-group">
        <label class="filter-label">Durum:</label>
        <div class="filter-buttons">
          <button 
            *ngFor="let option of statusOptions" 
            [class.active]="selectedStatus === option.value"
            (click)="selectedStatus = option.value; onStatusChange()"
            class="filter-button"
          >
            {{ option.label }}
          </button>
        </div>
      </div>


    </div>
  </div>

  <!-- Requests List -->
  <div class="requests-list">
    <div *ngIf="isLoading" class="loading-state">
      <i class="pi pi-spin pi-spinner"></i>
      <p>İstekler yükleniyor...</p>
    </div>

    <div *ngIf="!isLoading && filteredRequests.length === 0" class="empty-state">
      <i class="pi pi-inbox empty-icon"></i>
      <h3>Henüz İstek Yok</h3>
      <p>Filtreleme kriterlerinize uygun istek bulunamadı.</p>
    </div>

    <div *ngFor="let request of filteredRequests" class="request-card">
      <div class="request-header">
        <div class="user-info">
          <p-avatar 
            [label]="getUserAvatar(request.TargetFullName)" 
            size="large" 
            shape="circle"
            [style]="{'background-color': '#3498db', 'color': '#ffffff'}"
          ></p-avatar>
          <div class="user-details">
            <h3 class="user-name">{{ request.TargetFullName }}</h3>
            <p class="user-email">ID: {{ request.Id }}</p>
            <p class="user-guid" *ngIf="request.GuidId">GUID: {{ request.GuidId }}</p>
          </div>
        </div>
        
        <div class="request-meta">
          <div class="request-type">
            <i class="pi pi-user-plus"></i>
            <span>Muhasebeci Erişim Talebi</span>
          </div>
          <div class="request-date">
            {{ request.CreDate | date:'dd MMM yyyy' }}
          </div>
        </div>
      </div>

      <div class="request-content">
        <h4 class="request-title">Muhasebeci Yetkisi Talebi</h4>
        <p class="request-description">{{ request.TargetFullName }} kullanıcısı sistem muhasebeci yetkisi talep ediyor.</p>
      </div>

      <div class="request-footer">
        <div class="request-tags">
          <p-tag 
            [value]="getStatusLabel(request.Status)" 
            [severity]="getStatusColor(request.Status)"
          ></p-tag>
        </div>

        <div class="request-actions" *ngIf="request.Status === 1">
          <p-button 
            label="Onayla" 
            icon="pi pi-check" 
            severity="success" 
            size="small"
            (click)="approveRequest(request)"
            [pTooltip]="'İsteği onayla'"
          ></p-button>
          <p-button 
            label="Reddet" 
            icon="pi pi-times" 
            severity="danger" 
            size="small"
            [outlined]="true"
            (click)="rejectRequest(request)"
            [pTooltip]="'İsteği reddet'"
          ></p-button>
        </div>

        <div class="request-status" *ngIf="request.Status !== 1">
          <i 
            [class]="request.Status === 2 ? 'pi pi-check-circle text-success' : request.Status === 3 ? 'pi pi-times-circle text-danger' : 'pi pi-ban text-secondary'"
          ></i>
          <span [class]="request.Status === 2 ? 'text-success' : request.Status === 3 ? 'text-danger' : 'text-secondary'">
            {{ getStatusLabel(request.Status) }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
