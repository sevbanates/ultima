<div class="invoice-product-container">
  <!-- Header -->
  <div class="invoice-product-header">
    <div class="header-content">
      <div class="header-icon">
        <i class="pi pi-shopping-cart animated-icon"></i>
      </div>
      <div class="header-text">
        <h3 class="header-title">Fatura Detayları</h3>
        <p class="header-subtitle">Ürün ve hizmet bilgilerini ekleyiniz</p>
      </div>
    </div>
  </div>

  <!-- Form Card -->
  <div class="form-card">
    <form [formGroup]="productForm" class="invoice-product-form">
      
      <!-- Product Information Section -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">
            <i class="pi pi-box"></i>
          </div>
          <div class="section-title">Ürün Bilgileri</div>
          <span class="section-subtitle">Mal veya hizmet detaylarını giriniz</span>
        </div>
        <div class="form-grid">
          <!-- Ürün Adı -->
          <div class="form-group">
            <div class="input-wrapper">
              <label for="productName" class="field-label required">
                <i class="label-icon pi pi-tag"></i>
                Mal veya Hizmet Adı
              </label>
            </div>
            <input 
              id="productName" 
              type="text" 
              pInputText 
              formControlName="productName" 
              placeholder="Ürün veya hizmet adını giriniz"
              class="modern-input"
            />
            <div *ngIf="productForm.get('productName')?.invalid && productForm.get('productName')?.touched" class="error-message">
              <i class="pi pi-exclamation-triangle"></i>
              Ürün adı zorunludur
            </div>
          </div>

          <!-- Miktar -->
          <div class="form-group">
            <div class="input-wrapper">
              <label for="quantity" class="field-label required">
                <i class="label-icon pi pi-hashtag"></i>
                Miktar
              </label>
            </div>
            <input 
              id="quantity" 
              type="number" 
              pInputText 
              formControlName="quantity" 
              placeholder="Miktar giriniz"
              class="modern-input"
            />
            <div *ngIf="productForm.get('quantity')?.invalid && productForm.get('quantity')?.touched" class="error-message">
              <i class="pi pi-exclamation-triangle"></i>
              Miktar zorunludur
            </div>
          </div>

          <!-- Birim -->
          <div class="form-group">
            <div class="input-wrapper">
              <label for="unit" class="field-label required">
                <i class="label-icon pi pi-cog"></i>
                Birim
              </label>
            </div>
            <p-dropdown 
              inputId="unit" 
              formControlName="unit" 
              [options]="units" 
              optionLabel="label" 
              placeholder="Birim seçiniz"
              class="modern-dropdown"
              appendTo="body"
            />
          </div>

          <!-- KDV Oranı -->
          <div class="form-group">
            <div class="input-wrapper">
              <label for="vatRate" class="field-label required">
                <i class="label-icon pi pi-percentage"></i>
                KDV Oranı (%)
              </label>
            </div>
            <p-dropdown 
              inputId="vatRate" 
              formControlName="vatRate" 
              [options]="vatRates" 
              optionLabel="label" 
              placeholder="KDV oranı seçiniz"
              class="modern-dropdown"
              appendTo="body"
            />
          </div>

          <!-- Birim Fiyat -->
          <div class="form-group">
            <div class="input-wrapper">
              <label for="unitPrice" class="field-label required">
                <i class="label-icon pi pi-dollar"></i>
                Birim Fiyat
              </label>
            </div>
            <input 
              id="unitPrice" 
              type="text" 
              pInputText 
              [value]="formatNumber(productForm.get('unitPrice')?.value)" 
              (input)="onUnitPriceInput($event)" 
              (keypress)="onKeyPress($event)" 
              placeholder="Birim fiyat giriniz"
              class="modern-input"
            />
            <div *ngIf="productForm.get('unitPrice')?.invalid && productForm.get('unitPrice')?.touched" class="error-message">
              <i class="pi pi-exclamation-triangle"></i>
              Birim fiyat zorunludur
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button 
            pButton 
            type="button" 
            [label]="isEditMode ? 'Güncelle' : 'Ekle'" 
            [icon]="isEditMode ? 'pi pi-check' : 'pi pi-plus'" 
            (click)="addProduct()" 
            class="modern-button primary"
            [title]="isEditMode ? 'Güncelle' : 'Ekle'"
            [attr.aria-label]="isEditMode ? 'Güncelle' : 'Ekle'"
          ></button>
          <button 
            *ngIf="isEditMode" 
            pButton 
            type="button" 
            label="İptal" 
            icon="pi pi-times" 
            (click)="resetForm()" 
            class="modern-button danger"
            title="İptal" 
            [@fadeInOut]
          ></button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Fiyat Hesaplama Alanı -->
<div class="summary-container">
  <div class="summary-header">
    <div class="summary-icon">
      <i class="pi pi-calculator"></i>
    </div>
    <div class="summary-title">Fiyat Özeti</div>
  </div>
  <div class="summary-cards">
    <div class="summary-card">
      <div class="summary-card-icon green">
        <i class="pi pi-money-bill"></i>
      </div>
      <div class="summary-card-content">
        <h5 class="summary-card-title">Mal Hizmet Tutarı</h5>
        <div class="summary-card-amount green">{{ getTotalAmount() | number:'1.0-0':'tr' }} ₺</div>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-card-icon orange">
        <i class="pi pi-percentage"></i>
      </div>
      <div class="summary-card-content">
        <h5 class="summary-card-title">Hesaplanan KDV</h5>
        <div class="summary-card-amount orange">{{ getTotalVAT() | number:'1.0-0':'tr' }} ₺</div>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-card-icon blue">
        <i class="pi pi-calculator"></i>
      </div>
      <div class="summary-card-content">
        <h5 class="summary-card-title">Vergiler Dahil Toplam</h5>
        <div class="summary-card-amount blue">{{ getTotalWithVAT() | number:'1.0-0':'tr' }} ₺</div>
      </div>
    </div>
  </div>
</div>

<!-- Ürün Listesi Tablosu -->
<div class="table-container">
  <div class="table-header">
    <div class="table-icon">
      <i class="pi pi-list"></i>
    </div>
    <div class="table-title">Ürün Listesi</div>
    <div class="table-subtitle">{{ productList.length }} ürün eklendi</div>
  </div>
  
  <div class="table-wrapper">
    <p-table [value]="productList" responsiveLayout="scroll" class="modern-table">
      <ng-template pTemplate="header">
        <tr>
          <th><i class="pi pi-tag"></i> Ürün Adı</th>
          <th><i class="pi pi-cog"></i> Birim</th>
          <th><i class="pi pi-percentage"></i> KDV</th>
          <th><i class="pi pi-hashtag"></i> Miktar</th>
          <th><i class="pi pi-dollar"></i> Birim Fiyat</th>
          <th><i class="pi pi-calculator"></i> KDV Tutarı</th>
          <th><i class="pi pi-money-bill"></i> Toplam</th>
          <th><i class="pi pi-cog"></i> İşlemler</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-product let-i="rowIndex">
        <tr [class.p-highlight]="isEditMode && editingIndex === i" class="table-row">
          <td class="product-name">{{ product.productName }}</td>
          <td>{{ getUnitLabel(product.unit) }}</td>
          <td>{{ getVatRateLabel(product.vatRate) }}</td>
          <td>{{ product.quantity }}</td>
          <td class="amount">{{ product.unitPrice | number:'1.0-0':'tr' }} ₺</td>
          <td class="amount">{{ getProductVATAmount(product) | number:'1.0-0':'tr' }} ₺</td>
          <td class="amount total">{{ getProductTotalAmount(product) | number:'1.0-0':'tr' }} ₺</td>
          <td class="actions">
            <button 
              pButton 
              icon="pi pi-pencil" 
              class="action-button edit" 
              (click)="editProduct(i)" 
              title="Düzenle" 
              type="button"
            ></button>
            <button 
              pButton 
              icon="pi pi-trash" 
              class="action-button delete" 
              (click)="deleteProduct(i)" 
              title="Sil" 
              type="button"
            ></button>
          </td>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8" class="empty-message">
            <div class="empty-content">
              <i class="pi pi-inbox empty-icon"></i>
              <p>Henüz ürün eklenmemiş</p>
              <small>Yukarıdaki formu kullanarak ürün ekleyebilirsiniz</small>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>


<!-- Complete Button -->
<div class="complete-container">
  <button 
    pButton 
    type="button" 
    label="Tamamla" 
    icon="pi pi-check" 
    (click)="completeTask()" 
    class="complete-button"
    title="Tamamla"
  ></button>
</div>

<!-- Delete Confirmation Dialog -->
<p-dialog 
  [(visible)]="deleteProductDialog" 
  header="Silme İşlemi" 
  [modal]="true" 
  [style]="{width:'450px'}"
  class="modern-dialog"
>
  <div class="dialog-content">
    <div class="dialog-icon">
      <i class="pi pi-exclamation-triangle"></i>
    </div>
    <div class="dialog-message">
      <p>Bu ürünü silmek istediğinize emin misiniz?</p>
      <small>Bu işlem geri alınamaz.</small>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <button 
      pButton 
      pRipple 
      icon="pi pi-times" 
      class="dialog-button cancel" 
      label="Vazgeç" 
      (click)="deleteProductDialog = false" 
      title="Hayır" 
      type="button"
    ></button>
    <button 
      pButton 
      pRipple 
      icon="pi pi-check" 
      class="dialog-button confirm" 
      label="Evet" 
      (click)="confirmDelete()" 
      title="Evet" 
      type="button"
    ></button>
  </ng-template>
</p-dialog>