<div class="flex align-items-center gap-2">
  <i class="pi pi-id-card text-2xl"></i>
  <span class="text-xl font-semibold">Fatura Detayları</span>
</div>
<form [formGroup]="productForm" class="grid p-fluid p-3 border-round ">

  <!-- Ürün Adı -->
  <div class="col-12 md:col-4">
    <label for="productName" class="block mb-2">Mal veya Hizmet Adı</label>
    <input id="productName" type="text" pInputText formControlName="productName" class="w-full" />
  </div>

  <!-- Kod -->
  <!-- <div class="col-12 md:col-4">
    <label for="productCode" class="block mb-2">Kod</label>
    <input id="productCode" type="text" pInputText formControlName="productCode" class="w-full" />
  </div> -->

  <!-- Miktar -->
  <div class="col-12 md:col-4">
    <label for="quantity" class="block mb-2">Miktar</label>
    <input id="quantity" type="number" pInputText formControlName="quantity" class="w-full" />
  </div>

  <!-- Birim -->
  <div class="col-12 md:col-4">
    <label for="unit" class="block mb-2">Birim</label>
    <p-dropdown inputId="unit" formControlName="unit" [options]="units" optionLabel="label" placeholder="Birim Seçin" class="w-full" />
  </div>

  <!-- KDV Oranı -->
  <div class="col-12 md:col-4">
    <label for="vatRate" class="block mb-2">KDV Oranı (%)</label>
    <p-dropdown inputId="vatRate" formControlName="vatRate" [options]="vatRates" optionLabel="label" placeholder="KDV Seçin" class="w-full" />
  </div>

  <!-- Birim Fiyat -->
  <div class="col-12 md:col-4">
    <label for="unitPrice" class="block mb-2">Birim Fiyat</label>
    <input id="unitPrice" type="text" pInputText [value]="formatNumber(productForm.get('unitPrice')?.value)" (input)="onUnitPriceInput($event)" (keypress)="onKeyPress($event)" class="w-full" />
  </div>

  <!-- Ekle Butonu -->
  <div class="col-12 text-right">
    <button pButton type="button" [label]="isEditMode ? 'Güncelle' : 'Ekle'" [icon]="isEditMode ? 'pi pi-check' : 'pi pi-plus'" (click)="addProduct()" class="p-button-success p-button-sm p-button-rounded mr-4" [title]="isEditMode ? 'Güncelle' : 'Ekle'"></button>
    <button *ngIf="isEditMode" pButton type="button" label="İptal" icon="pi pi-times" (click)="resetForm()" class="p-button-danger p-button-sm p-button-rounded" title="İptal" [@fadeInOut]></button>
  </div>

</form>

<!-- Fiyat Hesaplama Alanı -->
<div class="grid p-fluid p-3 border-round bg-gray-50 mb-3">
  <div class="col-12 md:col-4">
    <div class="p-3 border-round bg-white">
      <h5 class="text-primary mb-2">Mal Hizmet Tutarı</h5>
      <div class="text-2xl font-bold text-green-600">{{ getTotalAmount() | number:'1.0-0':'tr' }} ₺</div>
    </div>
  </div>
  <div class="col-12 md:col-4">
    <div class="p-3 border-round bg-white">
      <h5 class="text-primary mb-2">Hesaplanan KDV</h5>
      <div class="text-2xl font-bold text-orange-600">{{ getTotalVAT() | number:'1.0-0':'tr' }} ₺</div>
    </div>
  </div>
  <div class="col-12 md:col-4">
    <div class="p-3 border-round bg-white">
      <h5 class="text-primary mb-2">Vergiler Dahil Toplam Tutar</h5>
      <div class="text-2xl font-bold text-blue-600">{{ getTotalWithVAT() | number:'1.0-0':'tr' }} ₺</div>
    </div>
  </div>
</div>

<!-- Ürün Listesi Tablosu -->
<p-table [value]="productList" responsiveLayout="scroll" class="p-datatable-sm">
  <ng-template pTemplate="header">
    <tr>
      <th>Ad</th>
      <!-- <th>Kod</th> -->
     
      <th>Birim</th>
      <th>KDV</th>
      <th>Miktar</th>
      <th>Birim Fiyat</th>
      <th>KDV Tutarı</th>
      <th>Toplam Tutar</th>
      <th>İşlem</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-product let-i="rowIndex">
    <tr [class.p-highlight]="isEditMode && editingIndex === i">
      <td>{{ product.productName }}</td>
      <!-- <td>{{ product.productCode }}</td> -->
     
      <td>{{ getUnitLabel(product.unit) }}</td>
      <td>{{ getVatRateLabel(product.vatRate) }}</td>
      <td>{{ product.quantity }}</td>
      <td>{{ product.unitPrice | number:'1.0-0':'tr' }}</td>
      <td>{{ getProductVATAmount(product) | number:'1.0-0':'tr' }}</td>
      <td>{{ getProductTotalAmount(product) | number:'1.0-0':'tr' }}</td>
      <td class="text-right">
        <button pButton icon="pi pi-pencil" class="p-button-text p-button-sm mr-2" (click)="editProduct(i)" title="Düzenle" type="button"></button>
        <button pButton icon="pi pi-trash" class="p-button-text p-button-sm p-button-danger" (click)="deleteProduct(i)" title="Sil" type="button"></button>
      </td>
    </tr>
  </ng-template>
</p-table>


  <p-dialog [(visible)]="deleteProductDialog" header="Silme İşlemi" [modal]="true" [style]="{width:'450px'}">
            <div class="flex align-items-center justify-content-center">
                <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
                <span >Silmek istediğinize emin misiniz? <b></b></span>
            </div>
            <ng-template pTemplate="footer">
                <button pButton pRipple icon="pi pi-times" class="p-button-text" label="Vazgeç" (click)="deleteProductDialog = false" title="Hayır" type="button"></button>
                <button pButton pRipple icon="pi pi-check" class="p-button-text" label="Evet" (click)="confirmDelete()" title="Evet" type="button"></button>
            </ng-template>
        </p-dialog>



         <div class="col-12 text-right">
    <button pButton type="button" label="Tamamla" icon="pi pi-check" (click)="completeTask()" class="cyan-500 p-button-sm p-button-rounded" title="Tamamla"></button>
  </div>